```python
import matplotlib.pyplot as plt
from mpl_toolkits.mplot3d import Axes3D
from matplotlib import cm
import numpy as np
from math import sin, cos, pi

def plot_function(f,xmin,xmax,**kwargs):
    ts = np.linspace(xmin,xmax,1000)
    plt.plot(ts,[f(t) for t in ts], **kwargs)
```

## Chapter 12 물리계 최적화하기
####   
#### 포탄 시뮬레이터를 만들 것이다. 
#### 이 시뮬레이터는 발사 각도를 입력으로 받아서 오일러 방법을 실행하여 포탄이 지면에 닿을 때 까지 순간 움직임을 시물레이션하고, 시간에 따른 포탄의 위치 리스트를 출력한다.
#### 최종 수평 위치를 추력하는데 이 위치는 탄착점 또는 사거리에 해당한다.
#### 즉 발사 각도를 입력하면 해당 각도에서 포탄의 사거리가 출력된다.
#### 우선 사거리를 최대할 수 있는 각도를 찾을 것이다.
#### 각도를 찾는 두가지 방법이 있는데 첫번째는 시뮬레이션을 통해 그래프를 그려 찾는 것이고, 두번째는 시뮬레이터를 하지않고 발사각도 세타의 함수로서 발사체의 사거리에 대한 수식을 찾는 것이다.
---
## 12.1 포물선 운동 시뮬레이션 테스트하기
#### 첫번째로 포탄의 비행 경로를 계산하는 시뮬레이터를 만들 것이다.
#### 만들 시뮬레이션은 발사 각도와 제어하고자 하는 매개변수를 입력으로 받아 지면에 충돌할 때까지 시간에 따른 포탄의 위치를 리턴한다.
---
### 12.1.1 오일러 방법으로 시뮬레이션 만들기
#### 시뮬레이션을 진행할 때 수평방향은 x, 수직 방향은 z방향이라고 하겠다. x,y 로 정의하게 되면 나중에 3차원으로 넘어갈 때 동일하게 사용하기 위함이다.
#### 포탄이 발사되는 각도를 θ, 포탄의 초기 속도를 v라고 하면 이동 중인 객체의 속력 v는 속도벡터의 크기로 정의하므로 |v|가 되고 x성분과 z성분은 vx = |v|* cos(θ), vz = |v|* sin(θ)가 된다. 


```python
def trajectory(theta,speed=20,height=0,dt=0.01,g=-9.81): # 타임스텝 dt, 중력장 g, 각도 θ
    vx = 20 * cos(pi * theta / 180) # 포탄의 속도를 x,z 방향의 속도로 표현
    vz = 20 * sin(pi * theta / 180)
    t,x,z = 0, 0, height
    ts, xs, zs = [t], [x], [z] # 저장할 시간, x,z 위치 값
    while z >= 0: # 지면 위에 있을 때만 실행
        t += dt
        vz += g * dt # z축에 중력 작용 -> 속도 가변
        x += vx * dt # x축에는 아무런 힘이 작용하지 않음 -> 속도 일정
        z += vz * dt
        ts.append(t)
        xs.append(x)
        zs.append(z)
    return ts, xs, zs
```


```python
def plot_trajectories(*trajs,show_seconds=False):
    for traj in trajs:
        xs, zs = traj[1], traj[2]
        plt.plot(xs,zs)
        if show_seconds:
            second_indices = []
            second = 0
            for i,t in enumerate(traj[0]):
                if t>= second:
                    second_indices.append(i)
                    second += 1
            plt.scatter([xs[i] for i in second_indices], [zs[i] for i in second_indices])
    xl = plt.xlim()
    plt.plot(plt.xlim(),[0,0],c='k')
    plt.xlim(*xl)
    
    width = 7
    coords_height = (plt.ylim()[1] - plt.ylim()[0])
    coords_width = (plt.xlim()[1] - plt.xlim()[0])
    plt.gcf().set_size_inches(width , width * coords_height / coords_width)
```


```python
plot_trajectories(trajectory(45), trajectory(60))
```


    
![output_4_0](https://user-images.githubusercontent.com/100830660/183712764-917879d7-c142-4470-956c-dc228b7c3c44.png)
    


### 12.1.2 궤적의 특성 측정하기
#### 궤적이 어떻게 생겼나 보기 위해서는 궤적의 전체 값을 알아야 하지만 최종적으로 어디에 도착하는가를 보기위해서는 모든 값이 필요하지는 않다.
#### 위의 사유로 trajectory 함수의 결과를 입력으로 받아 사거리 또는 탄착점을 추출하는 함수를 만들것이다.
#### 입력 궤적 traj[1]은 x좌표의 리스트에 해당하고, traj[1],[-1]은 이 리스트의 마지막 성분이 된다.


```python
def landing_position(traj):
    return traj[1][-1]
```


```python
def hang_time(traj): # 체공시간 측정
    return traj[0][-1]
def max_height(traj): # 최대 높이 출력
    return max(traj[2])
```

---
### 12.1.3 서로 다른 발사각 살펴보기
#### tajectory 함수는 발사 각도를 입력으로 받아 체공 시간 동안 전체 시간 데이터 및 포탄의 위치 데이터를 생성한다. 
#### landing_position 함수는 척도를 계산하는 함수로 데이터를 입력으로 받아 수 하나를 생성한다.
#### 발사 각도가 탄착점에 미치는 효과를 알아보기 위해 발사각도를 여러 다른 값으로 바꾸어가며 얻은 탄착점을 플롯으로 찍어보겠다.


```python
angles = range(0,95,5) # 0부터 90까지 5씩 증가, 마지막 95는 포함되지 않음.
landing_positions = [landing_position(trajectory(theta)) for theta in angles]
plt.scatter(angles,landing_positions) # 대략 45도 부근에서 최대값을 가짐. 
```




    <matplotlib.collections.PathCollection at 0x248c8916af0>




    
![output_9_1](https://user-images.githubusercontent.com/100830660/183712770-bec1f205-aec4-484f-8caf-9060aff978a3.png)
    


## 12.2 최적 사거리 계산하기
#### 미분적분학을 사용해 대포의 최대 사거리와 최대 사거리를 만드는 발사 각도를 계산할 수 있다.
#### 처음에는 발사각도 θ에 대한 함수로 사거리 r을 알려주는 수식을 구하겠다.
#### 그 뒤에는 도함수를 사용해 함수 r(θ)의 최대값과 이 때의 각도 θ를 구하는 기법을 진행할 것이다.
#### 도함수 r'(θ)가 0이 아닌 θ값은 r(θ)가 최대값인 θ값이기도 하다. 
#### r(θ)의 그래프를 살펴보고 기울기의 변화를 살펴보겠다.
---
### 12.2.1 발사각의 함수로 발사체의 사거리 구하기


```python
trj = trajectory(45) # θ=45도
ts,zs = trj[0],trj[2]
plt.plot(ts,zs)
```




    [<matplotlib.lines.Line2D at 0x248c89a4250>]




    
![output_11_1](https://user-images.githubusercontent.com/100830660/183712774-38fa1754-278d-4834-8bfe-772d2d055be1.png)
    


#### 가속도는 중력으로 인해 z''(t) = g가 된다. z의 초기 속도가 z'(0) = |v| * sin(θ)이며, 초기 z위치가 z(0) = 0이다. 
#### 위치 함수 z(t)를 복구하려면 가속도 z''(t)를 두번 적분해서 구할 수 있다.
#### 첫번째 적분을 하게 되면 당연하게 속도가 나온다. z'(t) = |v| * sin(θ) +gt 가 된다.
#### 두번째 적분을 하게되면 위치가 나온다. z(t) = |v| * sin(θ) * t + 0.5 * g * t^2 


```python
def z(t):
    return 20*sin(45*pi/180)*t + (-9.81/2)*t**2 # 45도를 라디안 값으로 변경
```


```python
plt.plot(ts,zs)
plot_function(z,0,2.9) # 위에 구한 시뮬레이션과 동일함
```


    
![output_14_0](https://user-images.githubusercontent.com/100830660/183712775-191dd82c-bcf8-4f15-8bae-6f71337aed83.png)
    


#### 초기 속도 |v| * sin(θ)를 vx라고 표현하면 z(t) = vz * t + gt^2 * 0.5 가 된다.
#### z(t) = 0 을 만족하면 t 값을 구하면 그 값은 포탄의 총 제공시간이 된다.
#### 근의 공식을 사용하면 당연하게 z(t) = 0을 만족하는 값은 두개가 나온다.
#### 생각을 조금만 해보면 처음에 출발할때 z(t) = 0의 값으로 출발하는 것을 알수있다. 
#### 즉  z = 0에서 포탄이 출발함을 확인해주는 적합성 확인 역할을 한다고 할 수 있다.
#### 체공 시간이 Δt  = -2vz/g = -2|v|sin(θ)/g 로 계산된다고 할 수 있다.
#### 이때의 사거리는 r = vx * Δt가 된다. 
#### 정리하면 r(θ) = -(2 * |v|^2)/ g * sin(θ) * cos(θ)가 된다.


```python
def r(theta):
    return (-2*20*20/-9.81)*sin(theta*pi/180) * cos(theta*pi/180)
```


```python
plot_function(r,0,90)
```


    
![output_17_0](https://user-images.githubusercontent.com/100830660/183712780-ce90d756-1c55-4c69-88aa-35ad66f39508.png)
    


#### 함수 r(θ)의 수식을 알면 모든 발사각도에서 대포의 사거리에 대해 알 수 있고, 여러번 반복하는 것보다 비용적으로 저렴하는 장점이 있다. #### 또한 함수 r(θ)가 매끄럽기 때문에 도함수를 취할 수 있다. 이를 통해 발사체의 사거리가 발사 각도에 대해 어떻게 변화하는지 알 수 있다.
---
### 12.2.2 최대사거리 구하기
#### r(θ)의 그래프가 매끈하고 미분이 가능함으로 r'(θ) 를 구할 수 있다.
#### 발사 각도를 0에서부터 증가시키면 사거리가 비례해서 계속 증가하는 것이 아니라 증가 비율이 감소하고, 결과적으로 사거리가 감소하게 된다.
#### 여기서의 핵심은 r'(θ)가 양수이면 사거리가 θ에대해 증가하고, r'(θ)가 0을 지나 음수가 되면 사거리는 θ에 대해 감소하게 된다.
#### 즉 도함수가 0인 r(θ)는 최대값을 가진다.
#### r(θ) = -(2 * |v|^2)/ g * sin(θ) * cos(θ)을 미분할 것이다.
#### 이때 sin(θ)cos(θ)에 있는 것들은 모두 상수다. 고로 삼각함수의 곱으로 이루어진 값만 곱의 미분법을 사용해 미분하면 된다.
#### r'(θ) = -(2 * |v|^2)/ g * (cos(θ)^2 - sin(θ)^2)이 된다.
#### cos(θ)^2 - sin(θ)^2은 삼각함수 항등식의 cos(2θ)가 된다. 고로 cos(2θ) = 0 의 값을 찾으면 된다.
#### 기존 cos(θ)함수는 90,270,430도에서 0 값을 가진다.
#### θ가 2θ로 두배가 되었으니 45,135,215도에서 0값을 가지게 된다.
#### 결론적으로 45,135,215... 도에서 사거리는 최대가 된다.


```python
r(45)
```




    40.774719673802245




```python
r(135)
```




    -40.77471967380224



#### 위의 값을 보면 같은 값이지만 부호만 반대이다.
#### 이것은 크게 다른 것을 의미하는 것이 아니라 쏘는 방향이 반대인 것을 의미한다.
---
### 12.2.3 최대 최소 식별하기
#### 매끄러운 함수는 최대값을 가지는 점에서 언제나 도함수가 0이된다. 하지만 역은 항상 참이 아니다.
#### 도함수가 0이더라도 최대값이 아닌 경우도 있다.
#### 위의 예시만 봐도 135도에서 도함수가 0이지만 최솟값이 된다.
#### 하지만 극대와 극소는 또 다른 개념이다.
#### 극소와 극대인 점에서 도함수가 0이 아니여도 상관이 없다.
#### 극소, 극대는 대략적으로 최대값, 최솟값으로 보이지만 전역 최댓값, 전역 최솟값이 있기도 하기 때문이다.
#### 도함수가 0인점인데도 극대, 극소가 아닌점도 존재한다. y = x^3을 보게되면 x = 0에서 도함수가 0이지만 이점은 극대, 극소중 아무곳에도 해당하지 않는다.
---
## 12.3 시뮬레이션 개선하기
#### 이전에 진행한 부분에서는 발사각도 θ가 유일한 매개변수였다. 이번에는 3차원으로 들려 xy평면 안에서의 각과 평면과 z축의 각 θ 두가지 모두를 매개변수로 보고 진행할 것이다.
### 12.3.1 다른 차원추가하기
#### xy평면에서 수직방향으로 대포를 쏜다고 가정할때 그 사잇각을 ɸ라고 하겠다.
#### 초기속도의 x성분은 vx = |v|cos(θ)였지만 각 한가지를 추가 되었기때문에 vx = |v|cos(θ)cos(ɸ)가 된다.


```python
def trajectory3d(theta,phi,speed=20,height=0,dt=0.01,g=-9.81):
    vx = speed * cos(pi*theta/180)*cos(pi*phi/180)
    vy = speed * cos(pi*theta/180)*cos(pi*phi/180)
    vz = speed * sin(pi*theta/180)
    t,x,y,z = 0,0,0,height
    ts,xs,ys,zs = [t], [x], [y], [z]
    while z >=0 :
        t+=dt
        vz +=g*dt
        x += vx*dt
        y += vy*dt
        z += vz*dt
        ts.append(t)
        xs.append(x)
        ys.append(y)
        zs.append(z)
    return ts,sx,ys,zs
```

#### 수평에서 발사한다고하면 theta의 변화량은 없을 것이다.
---
### 12.3.2 대포 주변의 지형 모델링하기
#### 이번에는 평지에서 발사하는 것이 아니라 주변에 경사도가 있는 곳에서 발사한다고 가정해보겠다.
#### 왜 이런 상황을 만드는지 생각해보면 이전에 ɸ를 추가했지만 평지에서는 포탄이 멀리, 높게 날라가는 것과는 관련이 없는 변수였기 때문이다.
#### 하지만 경사도가 있으면 날리는 곳에 따라 z축의 좌표값이 다르게 된다. 고로 포탄을 날리는 시간이 달라지게 된다는 것이다.


```python
def flat_ground(x,y):
    return 0
def ridge(x,y):
    return (x**2 - 5*y**2) /2500
```


```python
def trajectory3d(theta,phi,speed=20,height=0,dt=0.01,g=-9.81,elevation=flat_ground):
    vx = speed * cos(pi * theta / 180) * cos(pi * phi / 180)
    vy = speed * cos(pi * theta / 180) * sin(pi * phi / 180)
    vz = speed * sin(pi * theta / 180)
    t,x,y,z = 0, 0, 0, height
    ts, xs, ys, zs = [t], [x], [y], [z]
    while z >= 0:
        t += dt
        vz += g * dt
        x += vx * dt
        y += vy * dt
        z += vz * dt
        ts.append(t)
        xs.append(x)
        ys.append(y)
        zs.append(z)
    return ts, xs, ys, zs
```


```python
def plot_trajectories_3d(*trajs,elevation=flat_ground,bounds=None,zbounds=None,shadows=False):
    fig, ax = plt.gcf(), plt.gca(projection='3d')
    fig.set_size_inches(7,7)    

    if not bounds:
        xmin = min([x for traj in trajs for x in traj[1]])
        xmax = max([x for traj in trajs for x in traj[1]])
        ymin = min([x for traj in trajs for x in traj[2]])
        ymax = max([x for traj in trajs for x in traj[2]])

        padding_x = 0.1 * (xmax-xmin)
        padding_y = 0.1 * (ymax-ymin)
        xmin -= padding_x
        xmax += padding_x
        ymin -= padding_y
        ymax += padding_x
    
    else:
        xmin, xmax, ymin, ymax = bounds
    

    plt.plot([xmin,xmax],[0,0],[0,0],c='k')
    plt.plot([0,0],[ymin,ymax],[0,0],c='k')

    g = np.vectorize(elevation)
    ground_x = np.linspace(xmin, xmax, 20)
    ground_y = np.linspace(ymin, ymax, 20)
    ground_x, ground_y = np.meshgrid(ground_x,ground_y)
    ground_z = g(ground_x,ground_y)
    ax.plot_surface(ground_x, ground_y, ground_z, cmap=cm.coolwarm, alpha=0.5,
                       linewidth=0, antialiased=True)
    for traj in trajs:
        ax.plot(traj[1],traj[2],traj[3])
        if shadows:
            ax.plot([traj[1][0],traj[1][-1]],[traj[2][0],traj[2][-1]],[0,0],c='gray',linestyle='dashed')
    
    if zbounds:
        ax.set_zlim(*zbounds)
```


```python
plot_trajectories_3d(trajectory3d(20,0,elevation=ridge),trajectory3d(20,270,elevation=ridge), bounds=[0,40,-40,0], elevation=ridge)
```

    C:\Users\jangs\AppData\Local\Temp\ipykernel_7384\3290748045.py:2: MatplotlibDeprecationWarning: Calling gca() with keyword arguments was deprecated in Matplotlib 3.4. Starting two minor releases later, gca() will take no keyword arguments. The gca() function should only be used to get the current axes, or if no axes exist, create new axes with default keyword arguments. To create a new axes with non-default arguments, use plt.axes() or plt.subplot().
      fig, ax = plt.gcf(), plt.gca(projection='3d')
    


    
![output_27_1](https://user-images.githubusercontent.com/100830660/183712782-78f12e4e-d9f6-4e69-b260-8c8e89309d8e.png)
    


#### 위의 그래프를 보면 대포의 최대사거리는 내리막방향이 있는곳에서 얻을 수 있다는 것을 볼 수 있다.
#### 내리막 방향으로 가면 포탄이 더 아래로 떨어질 수 있고, 이는 시간과 이동거리가 더 늘어난다고 볼 수 있다.
#### 이전에 구한 theta값은 평지에서 구한값으로 다시 theta값과 phi값을 구해야 할 것이다.
---
### 12.3.3 3차원에서 사거리 수식 구하기
#### 우리의 목표는 포의 궤적과 지면의 궤적이 만나는 점을 계산하는 것이다.
#### xy평면의 x값과 y값을 좌표로 사용하기보단 궤적의 점에 대응되는 xy평면 상의 점과 원점 간의 거리 d를 좌표로 사용한다. 어떤 거리에서 포탄의 궤적과 지형의 고도의 z 값이 같아져서 포탄이 멈춘다. 이때의 거리가 수직 형태로 구하려는 사거리이다.


```python
from math import sqrt
B = 0.001  # 능선 모양, 발사각도, 중력가속도 상수
C = 0.005
v = 20
g = -9.81

def velocity_components(v,theta,phi): # 초기 x,y,z 성분
    vx = v * cos(theta*pi/180) * cos(phi*pi/180)
    vy = v * cos(theta*pi/180) * sin(phi*pi/180)
    vz = v * sin(theta*pi/180)
    return vx,vy,vz
    
def landing_distance(theta,phi): 
    vx, vy, vz = velocity_components(v, theta, phi)
    v_xy = sqrt(vx**2 + vy**2) # 초기속도의 수평성분
    a = (g/2) - B * vx**2 + C * vy**2 
    b = vz
    landing_time = -b/a # 착지 시잔에 대한 이차방정식 해 -b/a
    landing_distance = v_xy * landing_time # 수평이동거리
    return landing_distance
```


```python
landing_distance(30,240)
#trajectory3d(30,240,elevation=ridge)
```




    44.92998203810316



---
## 12.4 경사상승법으로 사거리 최적화하기



### 12.4.1 발사 매개변수 대비 사거리 플로팅하기 
#### 히트맵을 사용해 한 방향은 θ를 변화시키고 다른 방향으로 ɸ를 변화시킨다.
#### 이런 2차원은 θ와 ɸ를 좌표로 갖는 추상 공간이다.
#### 두 매개변수가 변함에 따라 사거리 r이 어떻게 변화하는지 볼 수 있다.
#### 그래프에서 밝은 값은 더 높은 사거리를 나타내며, 가장 밝은 점이 두개 있는 것으로 보인다.
#### 이 두 점에서 대포의 최대 사거리가 된다.


```python
def scalar_field_heatmap(f,xmin,xmax,ymin,ymax,xsteps=100,ysteps=100):
    fig = plt.figure()
    fig.set_size_inches(7,7)

    fv = np.vectorize(f)

    X = np.linspace(xmin, xmax, xsteps)
    Y = np.linspace(ymin, ymax, ysteps)
    X, Y = np.meshgrid(X, Y)
    
    z = fv(X,Y)

    fig, ax = plt.subplots()

    c = ax.pcolormesh(X,Y,z, cmap='plasma')
    # set the limits of the plot to the limits of the data
    ax.axis([X.min(), X.max(), Y.min(), Y.max()])
    fig.colorbar(c, ax=ax)
```


```python
scalar_field_heatmap(landing_distance,0,90,0,360)
```


    <Figure size 504x504 with 0 Axes>



    
![output_33_1](https://user-images.githubusercontent.com/100830660/183712783-7fa3a794-946e-4b21-9d89-0a7869dbe530.png)
    


---
### 12.4.2 사거리 함수의 그라디언트
#### 일변수함수 f(x)에 대해 f가 최댓값을 가질 때 f'(x) = 0가 된다. 이 점에서 f(x)는 순간적으로 평평해지며 f(x)의 기울기가 0임을 나타낸다.
#### 이것을 유사하게 r(θ,ɸ)의 3차원 플롯을 그려보겠다.


```python
def plot_scalar_field(f,xmin,xmax,ymin,ymax,xsteps=100,ysteps=100,c=None,cmap=cm.coolwarm,alpha=1,antialiased=False):
    fig = plt.gcf()
    fig.set_size_inches(7,7)
    ax = fig.gca(projection='3d')

    fv = np.vectorize(f)
    
    # Make data.
    X = np.linspace(xmin, xmax, xsteps)
    Y = np.linspace(ymin, ymax, ysteps)
    X, Y = np.meshgrid(X, Y)
    Z = fv(X,Y)

    # Plot the surface.
    surf = ax.plot_surface(X, Y, Z, cmap=cmap,color=c,alpha=alpha,
                           linewidth=0, antialiased=antialiased)
```


```python
plot_scalar_field(landing_distance,0,90,0,360)
```

    C:\Users\jangs\AppData\Local\Temp\ipykernel_7384\1378951377.py:4: MatplotlibDeprecationWarning: Calling gca() with keyword arguments was deprecated in Matplotlib 3.4. Starting two minor releases later, gca() will take no keyword arguments. The gca() function should only be used to get the current axes, or if no axes exist, create new axes with default keyword arguments. To create a new axes with non-default arguments, use plt.axes() or plt.subplot().
      ax = fig.gca(projection='3d')
    


    
![output_36_1](https://user-images.githubusercontent.com/100830660/183712785-b83df62f-47c0-4a88-9481-5b4ca4b8fee9.png)
    


#### r(θ,ɸ)는 매끄러운 함수이므로 이 함수를 가장 잘 근사하는 평면이 존재한다
#### θ와 ɸ 방향에서 이 평면의 기울기는 각각 편도함수로 주어진다.
#### r(θ,ɸ)의 그래프도 해당 점에서 평평함을 의미한다.
#### r의 편도함수가 r의 그라디언트 성분으로 정의되므로 편도함수가 평평할 조건은 Δr(θ,ɸ)=0과 동등하다.
#### r(θ,ɸ)에 대해 그라디언트를 취한뒤 0이 되는 θ값과 ɸ값을 구해야 한다.
#### 하지만 모든 그라디언트가 0이되는 점이 최대점은 아니다. 앞에서 보았던 최대, 최소 개념을 생각해보면 이해가 될것이다.
#### 위의 그래프를 보면 중간에 움푹 들어간 곳이 보일것이다. 이런 안장점에서는 함수는 한 변수에 대해서는 최대이지만, 동시에 다른 변수에서는 최솟값이 된다.
---
### 12.4.3 그라디언트로 오르막 방향 구하기
#### 함수가 복잡하면 편도함수를 기호적으로 취하는 방법 대신에 편미분계수를 근사적으로 구할 수 있다.
#### 이렇게 얻은 그라디언트의 방향은 임의의 주어진 점에서 함수를 가장 빠르게 증가시키는 방법이다.
#### 해당 방향을 따라 새 점으로 가면 오르막으로 이동하기 때문에 최대값을 향하며 이러한 방법을 `경사상승법`이라고 한다.
#### 첫번째로 임의의 점에서 그라디언트 값을 근사적으로 구해보겠다.
#### 작은 할선의 기울기를 취하는 방법으로 구할 수 있다.


```python
def secant_slope(f,xmin,xmax):
    return (f(xmax)-f(xmin))/(xmax-xmin)
def approx_derivative(f,x,dx=1e-6):
    return secant_slope(f,x-dx,x+dx)
```

#### (x0, y0)에서 f(x,y)의 근사적인 편미분계수를 구하기 위해서는 x = x0으로 고정한 뒤 y에 대해 도함수를 취하거나 y=y0으로 고정한 뒤 x에 대한 도함수를 취하면 된다.


```python
def approx_gradient(f,x0,y0,dx=1e-6):
    partial_x = approx_derivative(lambda x : f(x,y0), x0, dx=dx)
    partial_y = approx_derivative(lambda y : f(x0,y), y0, dx=dx)
    return (partial_x,partial_y)
```


```python
def landing_distance_gradient(theta,phi):
    return approx_gradient(landing_distance, theta, phi)
```


```python
from vectors import to_polar, to_cartesian

def draw_arrow(tip,tail,color='k'):
    tip_length = (plt.xlim()[1] - plt.xlim()[0]) / 20.
    length = sqrt((tip[1]-tail[1])**2 + (tip[0]-tail[0])**2)
    new_length = length - tip_length
    new_y = (tip[1] - tail[1]) * (new_length / length)
    new_x = (tip[0] - tail[0]) * (new_length / length)
    plt.gca().arrow(tail[0], tail[1], new_x, new_y,
    head_width=tip_length/1.5, 
    head_length=tip_length/2,
    fc=color, ec=color)
    
def plot_vector_field(f,xmin,xmax,ymin,ymax,xsteps=10,ysteps=10,color='k'):

    X,Y = np.meshgrid(np.linspace(xmin,xmax, xsteps),np.linspace(ymin,ymax, ysteps))
    U = np.vectorize(lambda x,y : f(x,y)[0])(X,Y)
    V = np.vectorize(lambda x,y : f(x,y)[1])(X,Y)
    plt.quiver(X, Y, U, V,color=color)
    fig = plt.gcf()
```


```python
scalar_field_heatmap(landing_distance,0,90,0,360)
plot_vector_field(landing_distance_gradient,0,90,0,360,xsteps=10,ysteps=10,color='k')
plt.xlabel('theta')
plt.ylabel('phi')
plt.gcf().set_size_inches(9,7)
```


    <Figure size 504x504 with 0 Axes>



    
![output_43_1](https://user-images.githubusercontent.com/100830660/183712787-edfcaf3f-3186-410b-9082-184dda0ba5eb.png)
    


#### 공간의 모든 점에 벡터를 부여하고 임의의 점 (θ,ɸ)에서 r이 가장 가파르게 증가하는 벡터를 알려준다.
#### 그라디언트의 화살표들이 함수의 최대점으로 수렴하는 것을 볼 수 있다.


```python
scalar_field_heatmap(landing_distance,35,40,80,100)
plot_vector_field(landing_distance_gradient,35,40,80,100,xsteps=10,ysteps=15,color='k')
plt.xlabel('theta')
plt.ylabel('phi')
plt.gcf().set_size_inches(9,7)
```


    <Figure size 504x504 with 0 Axes>



    
![output_45_1](https://user-images.githubusercontent.com/100830660/183712791-8ba39145-3724-415e-a704-0bde8c97f87e.png)
    


#### 경사상승법 알고리즘을 구현할 것이다.
#### 임의로 선택한 점 (θ,ɸ)에서 시작해서 어떤 최대값에 도달할 때까지 그라디언트 장을 따라간다.
---
### 12.4.4 경사상승법 구현하기
#### 경사상승법 알고리즘은 최적화하려는 함수와 탐색을 시작할 시작점을 입력으로 받는다.
#### 시작점에서 그라디언트를 계산한 뒤 그 값을 시작점에 더하는 방식으로 알고리즘을 구현할 것이다.
#### 새 점은 원래 점에서 그라디언트 방향으로 약간씩 이동한다. 이것을 반복해 최댓값에 가까운 점으로 이동하는 것이다.
#### 결과적으로 최대값 방향으로 계속 이동해 그라디언트가 0에 가까워지면 알고리즘이 종료된다.
#### 알고리즘에 허용오차를 전달해 그 허용오차보다 작아지면 그래프가 평평하다고 판단하며 이것은 곧 함수의 어떤 최대점에 도달했다고 할 수 있다.


```python
from vectors import length

def gradient_ascent(f,xstart,ystart,tolerance=1e-6):
    x = xstart
    y = ystart
    grad = approx_gradient(f,x,y)
    while length(grad)>tolerance:
        x += grad[0]
        y += grad[1]
        grad = approx_gradient(f,x,y)
    return x,y
```


```python
gradient_ascent(landing_distance,36,83) # (θ,ɸ) = (36,83)을 시작점으로 두고 최대점에 근접한 결과
```




    (37.58114751557887, 89.99992616039857)




```python
def gradient_ascent_points(f,xstart,ystart,tolerance=1e-6):
    x = xstart
    y = ystart
    xs, ys = [x], [y]
    grad = approx_gradient(f,x,y)
    while length(grad) > tolerance:
        x += grad[0]
        y += grad[1]
        grad = approx_gradient(f,x,y)
        xs.append(x)
        ys.append(y)
    return xs, ys
```


```python
gradient_ascent_points(landing_distance,36,83) # 오일러 방법을 반복하면서 시간과 위치 값을 계속 추적한 결과이다.
```




    ([36,
      36.122600166772905,
      36.23613677117784,
      36.34128767809185,
      36.43867738707969,
      36.528881661579746,
      36.612431593208484,
      36.689817410269534,
      36.76149182796271,
      36.82787319253559,
      36.889348238189385,
      36.94627463082189,
      36.998983312818545,
      37.04778060625894,
      37.09295017401476,
      37.1347547357105,
      37.17343773749891,
      37.20922482998986,
      37.24232519341257,
      37.27293280238169,
      37.30122755921293,
      37.32737638815892,
      37.35153417332558,
      37.373844629087024,
      37.394441177605785,
      37.41344766648102,
      37.43097908994937,
      37.44714219995173,
      37.46203614206898,
      37.47575300263992,
      37.48837829193029,
      37.49999144506543,
      37.51066624835594,
      37.520471237201555,
      37.529470054915286,
      37.537721861285455,
      37.545281588371104,
      37.55220026024622,
      37.5585252985331,
      37.5643007355652,
      37.56956745597163,
      37.57436347378886,
      37.57872406035837,
      37.58268198235851,
      37.58626769365101,
      37.58950943120426,
      37.59243345312513,
      37.59506413458223,
      37.597424081492754,
      37.59953426907831,
      37.60141419463162,
      37.60308194857079,
      37.60455430680984,
      37.605846830234725,
      37.606973946415735,
      37.60794904553076,
      37.60878455497228,
      37.60949197132179,
      37.61008195627306,
      37.61056440768643,
      37.61094847735236,
      37.61124264915114,
      37.61145474971101,
      37.61159207985861,
      37.61166135422281,
      37.6116688007107,
      37.611620160507606,
      37.611520766236765,
      37.611375531301206,
      37.611188971200036,
      37.61096529589897,
      37.61070836719779,
      37.61042175912645,
      37.61010874728699,
      37.60977237635503,
      37.609415420999966,
      37.609040442728364,
      37.60864981830568,
      37.6082457255454,
      37.60783013620363,
      37.60740486926978,
      37.606971605177414,
      37.606531871593425,
      37.606087093156,
      37.60563851331493,
      37.6051873222293,
      37.604734582160496,
      37.60428125944665,
      37.6038282209499,
      37.60337625537268,
      37.602926094574016,
      37.60247838870051,
      37.602033716844495,
      37.60159259414945,
      37.60115549667902,
      37.600722840100694,
      37.60029500100213,
      37.59987229557485,
      37.59945502935222,
      37.59904345102421,
      37.59863776309549,
      37.598238150307175,
      37.59784477963681,
      37.59745778608751,
      37.59707728689884,
      37.59670334246692,
      37.596336027398735,
      37.59597538787958,
      37.59562147009471,
      37.59527427404415,
      37.59493381393874,
      37.59460006490948,
      37.594273023403666,
      37.593952643236015,
      37.59363889243211,
      37.59333172835938,
      37.59303109062169,
      37.59273690461206,
      37.5924491205925,
      37.59216764974516,
      37.59189241391034,
      37.59162333137562,
      37.59136033108675,
      37.59110331001501,
      37.590852182895276,
      37.590606846698854,
      37.590367216160615,
      37.59013320246272,
      37.58990468836561,
      37.58968158149873,
      37.589463771727964,
      37.58925117378817,
      37.58904369175609,
      37.58884122260302,
      37.5886436704057,
      37.58845091081915,
      37.58826287278908,
      37.58807944262867,
      37.58790053507278,
      37.58772605064543,
      37.58755589342336,
      37.58738996393057,
      37.58722817334923,
      37.58707041509793,
      37.586916621675094,
      37.58676668649933,
      37.58662053496364,
      37.58647807114476,
      37.586339220435704,
      37.586203876255055,
      37.58607197820668,
      37.58594345523631,
      37.58581819010439,
      37.58569611886208,
      37.58557717756053,
      37.58546128093461,
      37.58534835437733,
      37.58523831262357,
      37.58513110948804,
      37.5850266810219,
      37.584924941960026,
      37.58482583190628,
      37.5847292833591,
      37.584635228816936,
      37.584543614989066,
      37.58445437437394,
      37.58436745012814,
      37.584282771197394,
      37.5842003127127,
      37.58411999651436,
      37.58404176931167,
      37.583965581366634,
      37.58389137583584,
      37.58381910298129,
      37.583748716617706,
      37.58368018121796,
      37.58361342572776,
      37.58354842172542,
      37.58348509815664,
      37.583423444363305,
      37.58336342126555,
      37.583304968467246,
      37.58324803267769,
      37.583192599686015,
      37.58313862330696,
      37.58308606446066,
      37.58303487696185,
      37.58298503594152,
      37.582936505872546,
      37.58288925122778,
      37.582843240032815,
      37.582798443865926,
      37.58275482364727,
      37.58271234384971,
      37.58267099026238,
      37.582630734463585,
      37.58259153026804,
      37.582553349254034,
      37.58251618431615,
      37.58248001058538,
      37.58244477832373,
      37.58241046621494,
      37.58237706004813,
      37.58234454916517,
      37.58231290159164,
      37.582282085353114,
      37.582252061369736,
      37.58222283319423,
      37.58219438661573,
      37.58216668610711,
      37.58213972456293,
      37.582113477114206,
      37.582087918891936,
      37.582063035685266,
      37.58203880617791,
      37.582015223264456,
      37.58199225852318,
      37.58196989774323,
      37.58194812671375,
      37.58192693832931,
      37.58190631127364,
      37.58188622423045,
      37.58186666298889,
      37.58184762399623,
      37.581829093041634,
      37.58181104880882,
      37.58179348774506,
      37.58177638498137,
      37.58175974051774,
      37.58174353659061,
      37.58172776254183,
      37.58171240416056,
      37.58169744013051,
      37.58168287400439,
      37.58166870222949,
      37.581654899936815,
      37.58164146002093,
      37.58162837892913,
      37.581615649555985,
      37.581603257690645,
      37.581591185569536,
      37.581579429639945,
      37.58156798279644,
      37.581556848591745,
      37.58154602702585,
      37.58153547901891,
      37.58152520101821,
      37.58151520368189,
      37.581505458588246,
      37.5814959728427,
      37.581486742892544,
      37.58147776873777,
      37.581469025509385,
      37.581460498996535,
      37.58145222117364,
      37.581444152960856,
      37.58143629080546,
      37.581428634707464,
      37.581421191772286,
      37.58141394778907,
      37.5814068956524,
      37.58140002115142,
      37.581393331391546,
      37.58138682282007,
      37.58138047767343,
      37.581374317267894,
      37.58136830962905,
      37.58136245120418,
      37.581356763309564,
      37.58135122107621,
      37.58134581384598,
      37.58134056293515,
      37.58133545058015,
      37.58133046967556,
      37.581325623774084,
      37.581320905770305,
      37.58131630500608,
      37.58131183924497,
      37.581307483617984,
      37.58130324523055,
      37.58129910987182,
      37.58129509885807,
      37.58129118376759,
      37.581287382363946,
      37.58128368754171,
      37.58128008153732,
      37.5812765714562,
      37.581273153745634,
      37.58126982485291,
      37.581266563461746,
      37.581263412204706,
      37.58126034976551,
      37.5812573619333,
      37.58125444870807,
      37.581251627853405,
      37.58124887094758,
      37.581246195754176,
      37.58124357740419,
      37.581241023003045,
      37.58123855031432,
      37.58123614512715,
      37.58123378612526,
      37.58123148396679,
      37.58122925996802,
      37.58122709636538,
      37.58122497894802,
      37.581222921926795,
      37.58122092174899,
      37.5812189784146,
      37.58121708837091,
      37.58121525517065,
      37.581213453944805,
      37.58121170956238,
      37.58121000781252,
      37.581208366458796,
      37.58120676418492,
      37.58120518678004,
      37.58120364845501,
      37.58120215986797,
      37.58120071036078,
      37.581199303486166,
      37.58119792858597,
      37.5811965856602,
      37.581195285366995,
      37.581194020600925,
      37.58119278780928,
      37.58119159054477,
      37.58119042170197,
      37.58118927417545,
      37.58118816572878,
      37.581187096361965,
      37.581186051864144,
      37.58118503223532,
      37.58118403747549,
      37.58118307113737,
      37.581182122562815,
      37.581181223726254,
      37.581180335547835,
      37.58117946513298,
      37.58117861958713,
      37.58117778825213,
      37.58117699244426,
      37.581176203741826,
      37.5811754434611,
      37.581174704496654,
      37.58117398684849,
      37.58117327275304,
      37.58117259418473,
      37.5811719369327,
      37.58117129033881,
      37.58117066150849,
      37.58117005399445,
      37.58116945358584,
      37.58116887449351,
      37.58116832027017,
      37.581167780257694,
      37.581167250903356,
      37.58116671089088,
      37.58116620995825,
      37.581165723236474,
      37.581165232961986,
      37.58116476400378,
      37.581164305703716,
      37.58116385450908,
      37.581163424630724,
      37.58116299475237,
      37.58116258974301,
      37.58116218473365,
      37.58116179748786,
      37.58116141379478,
      37.581161030101704,
      37.58116068193576,
      37.58116033732254,
      37.58115999270931,
      37.581159669412365,
      37.58115934611542,
      37.581159022818476,
      37.581158713732385,
      37.58115842596258,
      37.5811581452982,
      37.5811578610811,
      37.58115758752215,
      37.58115732462134,
      37.58115706527324,
      37.58115681658328,
      37.58115657499875,
      37.58115632630879,
      37.581156095382404,
      37.581155864456015,
      37.58115564063505,
      37.58115542391952,
      37.58115521430941,
      37.58115500114659,
      37.58115481640548,
      37.5811546139008,
      37.581154436265116,
      37.58115425862943,
      37.58115407033561,
      37.58115391046349,
      37.581153750591376,
      37.58115358006112,
      37.58115341308358,
      37.581153256764175,
      37.58115310399749,
      37.581152958336226,
      37.58115281622768,
      37.581152677671845,
      37.5811525355633,
      37.58115240056018,
      37.58115228332063,
      37.58115216252836,
      37.5811520417361,
      37.581151924496545,
      37.58115180370428,
      37.58115169001744,
      37.58115157988332,
      37.581151469749194,
      37.5811513667205,
      37.581151267244515,
      37.58115116776853,
      37.58115107184526,
      37.581150968816566,
      37.581150872893296,
      37.58115077341731,
      37.58115068104676,
      37.58115059578163,
      37.581150524727356,
      37.58115043946223,
      37.58115036485524,
      37.58115027959011,
      37.58115020853584,
      37.58115014458699,
      37.581150080638146,
      37.5811500166893,
      37.581149945635026,
      37.581149885238894,
      37.581149817737334,
      37.581149732472205,
      37.58114967207607,
      37.58114961878537,
      37.581149558389235,
      37.58114951220396,
      37.58114945891325,
      37.58114940206983,
      37.581149355884556,
      37.58114929904114,
      37.58114925285586,
      37.581149192459726,
      37.581149153379876,
      37.58114911074731,
      37.581149075220175,
      37.581149036140324,
      37.581148997060474,
      37.58114896508605,
      37.581148929558914,
      37.58114890468992,
      37.58114885850464,
      37.58114882653022,
      37.581148794555794,
      37.58114875192323,
      37.58114871639609,
      37.581148687974384,
      37.58114865599996,
      37.581148631130965,
      37.58114860981468,
      37.581148574287546,
      37.58114854941855,
      37.58114853876041,
      37.581148513891414,
      37.58114847836428,
      37.58114844994257,
      37.58114842152086,
      37.581148400204576,
      37.58114837533558,
      37.58114834691387,
      37.5811483291503,
      37.58114830428131,
      37.5811482758596,
      37.581148243885174,
      37.58114822967432,
      37.58114821191075,
      37.581148204805324,
      37.581148176383614,
      37.581148158620046,
      37.58114813375105,
      37.58114812309291,
      37.58114811598748,
      37.581148091118486,
      37.58114808756577,
      37.581148069802204,
      37.581148052038635,
      37.581148052038635,
      37.581148041380494,
      37.58114802716964,
      37.58114800585336,
      37.58114798098436,
      37.581147973878934,
      37.581147956115366,
      37.58114795256265,
      37.58114794900994,
      37.5811479383518,
      37.5811479383518,
      37.581147934799084,
      37.58114792769366,
      37.581147917035516,
      37.58114790282466,
      37.58114789571923,
      37.581147888613806,
      37.58114787440295,
      37.58114785308667,
      37.581147828217674,
      37.581147821112246,
      37.58114781755953,
      37.581147810454105,
      37.58114780690139,
      37.58114780334868,
      37.58114778558511,
      37.58114777847968,
      37.581147760716114,
      37.581147753610686,
      37.58114774650526,
      37.58114772874169,
      37.58114772518898,
      37.58114771808355,
      37.58114771808355,
      37.58114771097812,
      37.58114771808355,
      37.581147714530836,
      37.58114770742541,
      37.581147703872695,
      37.58114770031998,
      37.58114770742541,
      37.581147703872695,
      37.58114769676727,
      37.581147693214554,
      37.581147675450985,
      37.58114766834556,
      37.58114766124013,
      37.5811476541347,
      37.58114765768742,
      37.58114765768742,
      37.5811476541347,
      37.58114765058199,
      37.581147647029276,
      37.581147647029276,
      37.58114764347656,
      37.58114763992385,
      37.58114763281842,
      37.581147625712994,
      37.58114761860757,
      37.58114761505485,
      37.58114761150214,
      37.58114761150214,
      37.58114761505485,
      37.58114761150214,
      37.58114761150214,
      37.58114761150214,
      37.58114761150214,
      37.58114761505485,
      37.58114761860757,
      37.58114761505485,
      37.58114761505485,
      37.58114761150214,
      37.58114761150214,
      37.58114761505485,
      37.58114761150214,
      37.58114761505485,
      37.58114761150214,
      37.58114761505485,
      37.58114761150214,
      37.58114761150214,
      37.581147607949426,
      37.581147597291285,
      37.58114758308043,
      37.58114758663314,
      37.58114758663314,
      37.581147579527716,
      37.58114757242229,
      37.581147575975,
      37.58114756531686,
      37.581147568869575,
      37.58114756176415,
      37.581147568869575,
      37.58114756176415,
      37.58114756176415,
      37.58114756176415,
      37.581147568869575,
      37.58114756176415,
      37.58114755465872,
      37.581147558211434,
      37.58114755110601,
      37.58114756531686,
      37.58114756176415,
      37.58114756531686,
      37.58114757242229,
      37.58114758308043,
      37.58114759018586,
      37.58114757242229,
      37.58114757242229,
      37.581147568869575,
      37.58114756176415,
      37.58114756176415,
      37.58114756176415,
      37.581147558211434,
      37.58114755465872,
      37.58114755465872,
      37.58114756531686,
      37.58114756176415,
      37.58114756176415,
      37.581147558211434,
      37.58114754400058,
      37.58114753689515,
      37.58114754755329,
      37.581147540447866,
      37.58114754400058,
      37.58114754400058,
      37.58114754400058,
      37.58114754755329,
      37.581147540447866,
      37.581147540447866,
      37.58114754400058,
      37.58114754755329,
      37.58114754400058,
      37.581147540447866,
      37.58114755110601,
      37.58114755110601,
      37.58114755110601,
      37.581147558211434,
      37.58114755110601,
      37.581147558211434,
      37.58114754755329,
      37.58114755110601,
      37.58114755110601,
      37.58114755465872,
      37.58114756176415,
      37.58114756176415,
      37.58114755465872,
      37.58114754755329,
      37.58114754400058,
      37.58114754755329,
      37.58114753689515,
      37.58114753689515,
      37.581147540447866,
      37.58114754400058,
      37.581147540447866,
      37.58114754755329,
      37.581147540447866,
      37.58114754400058,
      37.58114754400058,
      37.58114754400058,
      37.58114754755329,
      37.581147540447866,
      37.581147540447866,
      37.58114754755329,
      37.581147540447866,
      37.58114754400058,
      37.581147540447866,
      37.58114754400058,
      37.581147540447866,
      37.58114754755329,
      37.58114754400058,
      37.58114754755329,
      37.58114755110601,
      37.58114755465872,
      37.58114755110601,
      37.581147558211434,
      37.58114755465872,
      37.58114755465872,
      37.58114755110601,
      37.58114755110601,
      37.58114755465872,
      37.581147558211434,
      37.58114755110601,
      37.581147558211434,
      37.58114755110601,
      37.58114755465872,
      37.58114755465872,
      37.58114755465872,
      37.58114755465872,
      37.58114755465872,
      37.58114755465872,
      37.58114755465872,
      37.58114755465872,
      37.58114755110601,
      37.58114755465872,
      37.58114755110601,
      37.581147558211434,
      37.58114754755329,
      37.581147540447866,
      37.58114754755329,
      37.58114753689515,
      37.58114753334244,
      37.58114753334244,
      37.581147519131584,
      37.5811475226843,
      37.58114751557887,
      37.58114751557887,
      37.581147512026156,
      37.581147501368015,
      37.58114750847344,
      37.58114751557887,
      37.581147519131584,
      37.581147519131584,
      37.581147519131584,
      37.581147529789725,
      37.581147519131584,
      37.58114752623701,
      37.58114752623701,
      37.5811475226843,
      37.581147519131584,
      37.58114751557887,
      37.58114750847344,
      37.58114751557887,
      37.58114751557887,
      37.58114751557887,
      37.58114751557887,
      37.581147519131584,
      37.581147519131584,
      37.5811475226843,
      37.581147519131584,
      37.581147519131584,
      37.581147512026156,
      37.581147512026156,
      37.58114750492073,
      37.58114750492073,
      37.581147501368015,
      37.58114751557887,
      37.581147512026156,
      37.581147512026156,
      37.58114750847344,
      37.58114751557887,
      37.581147519131584,
      37.581147519131584,
      37.5811475226843,
      37.581147519131584,
      37.5811475226843,
      37.5811475226843,
      37.58114752623701,
      37.5811475226843,
      37.581147519131584,
      37.581147529789725,
      37.58114752623701,
      37.581147519131584,
      37.5811475226843,
      37.58114751557887,
      37.58114751557887,
      37.581147512026156,
      37.58114750492073,
      37.58114750492073,
      37.58114750492073,
      37.58114750492073,
      37.58114750492073,
      37.581147501368015,
      37.581147512026156,
      37.58114750492073,
      37.58114750492073,
      37.58114750492073,
      37.58114750847344,
      37.58114750492073,
      37.581147501368015,
      37.58114750847344,
      37.58114750847344,
      37.58114750492073,
      37.581147512026156,
      37.58114750492073,
      37.58114750492073,
      37.58114750492073,
      37.58114750847344,
      37.58114750492073,
      37.581147501368015,
      37.581147512026156,
      37.58114750492073,
      37.58114750492073,
      37.58114750492073,
      37.58114750492073,
      37.58114750492073,
      37.58114750847344,
      37.581147512026156,
      37.58114750847344,
      37.58114750492073,
      37.58114750492073,
      37.58114750492073,
      37.58114750492073,
      37.58114750492073,
      37.58114750847344,
      37.58114750847344,
      37.58114751557887,
      37.58114751557887,
      37.581147519131584,
      37.581147519131584,
      37.581147519131584,
      37.58114751557887,
      37.58114751557887,
      37.581147512026156,
      37.58114750847344,
      37.58114750847344,
      37.58114751557887,
      37.58114751557887,
      37.58114751557887,
      37.58114751557887,
      37.581147519131584,
      37.58114752623701,
      37.58114752623701,
      37.58114752623701,
      37.58114752623701,
      37.58114752623701,
      37.58114752623701,
      37.581147529789725,
      37.58114751557887,
      37.58114751557887,
      37.581147512026156,
      37.58114750492073,
      37.58114750492073,
      37.58114750492073,
      37.58114750492073,
      37.58114750492073,
      37.581147501368015,
      37.581147512026156,
      37.58114750847344,
      37.581147519131584,
      37.58114751557887,
      37.581147512026156,
      37.58114750847344,
      37.581147512026156,
      37.58114750847344,
      37.581147512026156,
      37.581147501368015,
      37.58114750847344,
      37.58114750847344,
      37.581147512026156,
      37.581147501368015,
      37.581147512026156,
      37.58114750492073,
      37.58114750492073,
      37.58114750847344,
      37.58114750847344,
      37.58114750492073,
      37.58114750492073,
      37.58114750847344,
      37.58114750847344,
      37.58114751557887,
      37.581147519131584,
      37.5811475226843,
      37.581147519131584,
      37.5811475226843,
      37.5811475226843,
      37.581147519131584,
      37.5811475226843,
      37.58114751557887,
      37.58114751557887,
      37.581147512026156,
      37.58114750847344,
      37.58114750847344,
      37.58114751557887,
      37.58114751557887],
     [83,
      83.0963081634653,
      83.1909761811295,
      83.28405854451515,
      83.37560633098694,
      83.46566746665252,
      83.55428696794701,
      83.64150710150517,
      83.7273676328513,
      83.8119059898241,
      83.8951574508705,
      83.97715528360146,
      84.05793092598041,
      84.13751410001007,
      84.21593292186654,
      84.29321408308778,
      84.36938290741693,
      84.44446345738383,
      84.51847864088633,
      84.59145029645545,
      84.66339924654613,
      84.73434541832945,
      84.80430788277248,
      84.87330489727084,
      84.94135399801932,
      85.00847204264436,
      85.07467520309866,
      85.13997911842789,
      85.2043988592435,
      85.26794896680262,
      85.3306434956406,
      85.39249608107257,
      85.45351992498259,
      85.51372784200893,
      85.57313226664951,
      85.63174528878899,
      85.68957869633141,
      85.74664396098925,
      85.80295225604706,
      85.85851449188858,
      85.9133413302076,
      85.96744318756063,
      86.02083024602511,
      86.07351247806837,
      86.1254996465476,
      86.17680131181534,
      86.22742686724659,
      86.27738551436981,
      86.32668627707775,
      86.37533804426008,
      86.42334951295987,
      86.47072926298071,
      86.51748569293774,
      86.56362710552285,
      86.60916164000311,
      86.654097318406,
      86.69844204196679,
      86.74220358402302,
      86.78538959711997,
      86.82800762722152,
      86.87006509594656,
      86.91156935030699,
      86.95252760941703,
      86.99294696804591,
      87.0328344747776,
      87.07219704674563,
      87.111041508713,
      87.14937460728301,
      87.18720298247754,
      87.22453319615877,
      87.26137171426562,
      87.29772492102458,
      87.33359912250245,
      87.36900053594817,
      87.40393530755644,
      87.43840948049322,
      87.4724290446338,
      87.50599990103561,
      87.5391278725964,
      87.57181871471232,
      87.60407811172529,
      87.63591167337022,
      87.66732493477502,
      87.6983233422498,
      87.72891231368291,
      87.75909716748676,
      87.78888315812488,
      87.8182754867701,
      87.84727927643559,
      87.87589959684375,
      87.90414144311005,
      87.93200975350649,
      87.95950939525085,
      87.98664518227015,
      88.01342186454261,
      88.039844135203,
      88.06591661633183,
      88.09164389092977,
      88.11703045673234,
      88.14208079015879,
      88.16679927881052,
      88.19119026765635,
      88.21525805903259,
      88.2390068771158,
      88.26244090344998,
      88.28556426628846,
      88.30838105125197,
      88.33089526224883,
      88.35311087476566,
      88.3750318145511,
      88.39666195406303,
      88.4180051124687,
      88.43906505919733,
      88.45984551749285,
      88.48035017151936,
      88.50058264149212,
      88.52054651565193,
      88.54024533250164,
      88.55968256659523,
      88.57886168893397,
      88.59778608880673,
      88.61645912352795,
      88.63488410067404,
      88.65306429939977,
      88.67100295267458,
      88.68870322951909,
      88.70616830961204,
      88.72340126960349,
      88.74040518614348,
      88.75718307903865,
      88.77373795388479,
      88.79007273811797,
      88.806190337858,
      88.82209363435565,
      88.83778545557105,
      88.85326861170071,
      88.86854585609774,
      88.88361989592997,
      88.89849344902336,
      88.91316914793877,
      88.92764961457891,
      88.94193744597746,
      88.95603519298287,
      88.9699453709164,
      88.98367045601952,
      88.99721291032282,
      89.0105751532243,
      89.02375956859484,
      89.03676852609449,
      89.04960433143442,
      89.06226930453668,
      89.07476570137446,
      89.08709575305195,
      89.09926166580435,
      89.11126562455058,
      89.12310977868242,
      89.13479623140637,
      89.1463271001398,
      89.1577044383512,
      89.16893028885096,
      89.18000665892231,
      89.19093552742677,
      89.20171886967316,
      89.21235861478499,
      89.22285665280596,
      89.23321489154331,
      89.24343517130275,
      89.25351932883724,
      89.2634691831362,
      89.27328651410916,
      89.282973073244,
      89.29253061558126,
      89.30196083931808,
      89.31126543909892,
      89.32044608469919,
      89.32950443168346,
      89.33844210719462,
      89.34726071705926,
      89.35596182802409,
      89.36454703170486,
      89.37301785576845,
      89.38137581722361,
      89.3896224117628,
      89.39775912797306,
      89.40578742957241,
      89.41370876606805,
      89.4215245407819,
      89.42923618190484,
      89.43684505367894,
      89.44435254166252,
      89.45175998522866,
      89.45906870243412,
      89.4662800362047,
      89.47339527262272,
      89.48041568711243,
      89.48734254443988,
      89.49417708805487,
      89.50092055430176,
      89.50757413689234,
      89.51413904019657,
      89.52061645437352,
      89.52700753760786,
      89.53331344808424,
      89.5395353084602,
      89.54567424139327,
      89.55173134822468,
      89.55770772674296,
      89.56360443920951,
      89.56942255854386,
      89.57516314345469,
      89.5808272100181,
      89.58641577431023,
      89.59192985595989,
      89.59737042130521,
      89.60273847221146,
      89.60803496080588,
      89.61326085697932,
      89.61841709864821,
      89.62350460241267,
      89.62852428487282,
      89.63347705552339,
      89.63836380609548,
      89.6431854105567,
      89.64794274287458,
      89.65263664859499,
      89.65726798747465,
      89.66183759084856,
      89.66634627939358,
      89.67079485247028,
      89.67518412365011,
      89.67951487808278,
      89.68378790802346,
      89.68800396309473,
      89.6921638248936,
      89.69626822172637,
      89.70031790321563,
      89.70431359411499,
      89.70825601917802,
      89.71214588539476,
      89.71598388199166,
      89.71977072306417,
      89.72350708007518,
      89.72719362093486,
      89.7308310206588,
      89.73441992584091,
      89.73796097952236,
      89.74145482829704,
      89.74490209033712,
      89.74830338736751,
      89.75165934466582,
      89.75497056264066,
      89.75823762393708,
      89.76146113606912,
      89.76464167457638,
      89.76777980434036,
      89.77087609024252,
      89.77393110071706,
      89.77694539354003,
      89.77991947674947,
      89.78285392588501,
      89.78574924187927,
      89.78860595408662,
      89.7914245740978,
      89.7942056170563,
      89.79694958034206,
      89.79965695422953,
      89.80232823254595,
      89.80496389846034,
      89.80756442803637,
      89.81013028312681,
      89.81266192913715,
      89.81515982081474,
      89.81762440580151,
      89.82005612818666,
      89.82245541784856,
      89.82482272953456,
      89.82715848246487,
      89.82946308875427,
      89.83173696407027,
      89.8339805276331,
      89.83619417379396,
      89.83837831111492,
      89.84053331618365,
      89.8426595940095,
      89.84475751762741,
      89.84682747073046,
      89.84886981924815,
      89.85088495042628,
      89.85287321243078,
      89.85483495698033,
      89.8567705464517,
      89.85868033611627,
      89.86056465637641,
      89.86242384473992,
      89.86425824582004,
      89.86606818646642,
      89.86785400773957,
      89.86961601162015,
      89.8713545142997,
      89.87306983907514,
      89.87476230213801,
      89.87643219836353,
      89.87807982617966,
      89.87970548401434,
      89.88130946319009,
      89.88289205502944,
      89.88445353664406,
      89.8859942064619,
      89.8875143344892,
      89.88901419073218,
      89.89049405585526,
      89.89195418210107,
      89.89339483947589,
      89.89481629088051,
      89.89621878145218,
      89.89760258119713,
      89.89896793525263,
      89.90031507454503,
      89.90164425842246,
      89.90295571070588,
      89.90424968008524,
      89.90552639393422,
      89.90678608673193,
      89.90802898229931,
      89.90925531511549,
      89.91046528413241,
      89.9116591238292,
      89.91283704026323,
      89.91399925370276,
      89.91514597731062,
      89.91627740648605,
      89.91739375083915,
      89.91849520932192,
      89.91958197378086,
      89.92065425737883,
      89.92171223419876,
      89.92275611029807,
      89.92378606331243,
      89.92480229929926,
      89.9258049674725,
      89.92679427744228,
      89.92777039263342,
      89.92873348357618,
      89.92968373501168,
      89.93062131391746,
      89.93154640503461,
      89.9324591504717,
      89.9333597243117,
      89.93424829708486,
      89.93512502155788,
      89.93599005405015,
      89.93684356153922,
      89.9376856790282,
      89.93851656283651,
      89.93933637638897,
      89.94014526179411,
      89.9409433576078,
      89.94173081304397,
      89.94250775955307,
      89.94327435345447,
      89.94403072619859,
      89.94477700923585,
      89.94551334467478,
      89.9462398675185,
      89.94695669855928,
      89.94766396924753,
      89.94836180392822,
      89.9490503447099,
      89.94972970527942,
      89.95040000287632,
      89.95106136184557,
      89.95171390297946,
      89.9523577364121,
      89.9529929935939,
      89.95361977755354,
      89.95423819842517,
      89.95484838765918,
      89.95545043407343,
      89.95604445846017,
      89.95663055674267,
      89.95720884260777,
      89.95777941197873,
      89.95834237143698,
      89.95889782756393,
      89.95944587983554,
      89.95998662062239,
      89.96052016005859,
      89.96104658340928,
      89.96156599370315,
      89.9620784690999,
      89.96258410907551,
      89.96308301310597,
      89.96357525579826,
      89.96406092597023,
      89.964540133756,
      89.96501295376257,
      89.96547947125505,
      89.96593976084044,
      89.96639390778387,
      89.96684200090317,
      89.9672841325689,
      89.96772036672992,
      89.9681507815459,
      89.96857545162385,
      89.96899446222889,
      89.96940788796802,
      89.96981580700093,
      89.97021828327648,
      89.97061539495436,
      89.97100720598343,
      89.97139378741794,
      89.9717752174176,
      89.97215156348398,
      89.97252288246048,
      89.97288925250682,
      89.97325075178269,
      89.97360742647336,
      89.97395934408043,
      89.9743065685527,
      89.97464916028633,
      89.97498718678287,
      89.97532071909659,
      89.97564979630734,
      89.97597447881127,
      89.9762948270045,
      89.9766109119413,
      89.97692277980694,
      89.9772304945503,
      89.97753410235663,
      89.97783366006935,
      89.9781292245319,
      89.97842084548225,
      89.97870858331653,
      89.97899248066732,
      89.97927259437803,
      89.97954897418666,
      89.97982166272575,
      89.98009072039147,
      89.98035618626365,
      89.98061810652757,
      89.98087654513208,
      89.98113152694616,
      89.98138311591867,
      89.98163134757675,
      89.9818762752111,
      89.98211794855972,
      89.98235638538615,
      89.98259164608656,
      89.98282376974078,
      89.98305279542866,
      89.98327875867734,
      89.98350171277754,
      89.98372170391451,
      89.98393876050999,
      89.98415291453837,
      89.98436422639581,
      89.98457270674044,
      89.98477841241568,
      89.98498137894866,
      89.98518162410296,
      89.98537921538014,
      89.98557417054376,
      89.98576652156824,
      89.98595631108616,
      89.9861435675192,
      89.98632832639454,
      89.98651061968657,
      89.98669048292244,
      89.986867955182,
      89.98704305778153,
      89.98721582624817,
      89.98738628545091,
      89.98755446736418,
      89.98772041817324,
      89.98788415208897,
      89.9880457046385,
      89.98820510424352,
      89.98836236866762,
      89.98851754054337,
      89.98867063763431,
      89.98882170257303,
      89.98897076378123,
      89.98911782481161,
      89.98926293184948,
      89.98940609910566,
      89.98954736210732,
      89.98968674217072,
      89.98982425705942,
      89.98995993874787,
      89.99009381210506,
      89.99022590199996,
      89.99035622974888,
      89.99048480600996,
      89.99061167341576,
      89.99073684617711,
      89.99086035626847,
      89.9909822250061,
      89.99110245949544,
      89.99122109526361,
      89.9913381500742,
      89.99145364169077,
      89.99156759853501,
      89.99168002771238,
      89.99179096119728,
      89.99190041320057,
      89.9920084228021,
      89.99211498289645,
      89.99222012190533,
      89.99232386825044,
      89.99242621837907,
      89.99252720426564,
      89.99262684367373,
      89.99272516502504,
      89.9928221789777,
      89.9929178748736,
      89.99301230955614,
      89.9931054794726,
      89.9931974130447,
      89.99328811382514,
      89.99337759957751,
      89.9934658951708,
      89.99355302192127,
      89.99363898338166,
      89.99372379731552,
      89.99380748503916,
      89.99389005365798,
      89.99397152804097,
      89.99405189753001,
      89.99413120475766,
      89.99420946038207,
      89.99428666440322,
      89.99436284524283,
      89.99443801000632,
      89.99451217290455,
      89.99458534814838,
      89.99465754994866,
      89.9947287818581,
      89.99479905808755,
      89.99486841416416,
      89.99493683942978,
      89.99500434809528,
      89.99507096147693,
      89.99513667602201,
      89.9952015343631,
      89.9952655151839,
      89.99532865401156,
      89.99539094018793,
      89.99545239858202,
      89.99551303274653,
      89.99557286399775,
      89.99563188523024,
      89.99569012841843,
      89.99574759000961,
      89.99580429487278,
      89.99586023945523,
      89.99591544507322,
      89.99596990106863,
      89.99602362875774,
      89.99607665300952,
      89.99612897027129,
      89.99618057699031,
      89.99623150158831,
      89.99628175827614,
      89.99633134350108,
      89.99638026436857,
      89.99642853864216,
      89.99647616276914,
      89.99652314385494,
      89.99656949966314,
      89.99661524440458,
      89.99666037807927,
      89.99670492200349,
      89.99674885841367,
      89.99679220507338,
      89.99683497619347,
      89.99687717887936,
      89.9969188237892,
      89.99695990381757,
      89.99700044028074,
      89.99704043317873,
      89.99707988961694,
      89.99711882380625,
      89.99715723929936,
      89.99719514675441,
      89.9972325461714,
      89.99726944465577,
      89.99730584931292,
      89.99734177435373,
      89.99737721977819,
      89.99741219269173,
      89.99744669309435,
      89.99748074585504,
      89.99751433676296,
      89.99754748002896,
      89.99758018275845,
      89.99761244495146,
      89.99764428437153,
      89.99767569391325,
      89.99770669134018,
      89.99773726954689,
      89.99776743919152,
      89.99779720382679,
      89.99782657766356,
      89.99785556070182,
      89.99788414938887,
      89.99791236504097,
      89.99794020055272,
      89.99796766302953,
      89.99799475957683,
      89.99802149019462,
      89.99804787264647,
      89.99807391048509,
      89.99809959660506,
      89.99812493100637,
      89.99814994211073,
      89.99817461215457,
      89.99819895179604,
      89.99822296103514,
      89.99824665763543,
      89.99827003804421,
      89.99829310581418,
      89.99831586449807,
      89.99833831764857,
      89.99836046881842,
      89.99838232511303,
      89.99840390429597,
      89.99842518149825,
      89.99844617803615,
      89.99846689035695,
      89.99848732556609,
      89.99850749076899,
      89.99852738951836,
      89.99854702181419,
      89.99856640186735,
      89.99858551546698,
      89.99860438392938,
      89.99862298949095,
      89.99864134280986,
      89.99865946164967,
      89.99867733535223,
      89.99869497102297,
      89.99871237221461,
      89.99872954958529,
      89.99874649602958,
      89.9987632151002,
      89.99877970679714,
      89.99879597822583,
      89.99881203293899,
      89.99882787448932,
      89.99884349932412,
      89.99885892520696,
      89.99887414147969,
      89.99888915524774,
      89.9989039629584,
      89.99891858237523,
      89.99893299573466,
      89.99894721724756,
      89.99896125401933,
      89.99897509894457,
      89.9989887591287,
      89.99900224878256,
      89.9990155501426,
      89.99902866676153,
      89.99904161995563,
      89.99905439196134,
      89.99906701120035,
      89.99907945280368,
      89.99909172742947,
      89.99910383863043,
      89.99911578640656,
      89.999127581416,
      89.99913922010604,
      89.9991507060294,
      89.99916201786978,
      89.99917318760161,
      89.9991842152249,
      89.99919509718693,
      89.99920582638227,
      89.99921641702177,
      89.99922686910544,
      89.99923717197514,
      89.99924735049986,
      89.99925738691603,
      89.99926729898722,
      89.99927707250258,
      89.99928671812025,
      89.99929622162936,
      89.99930559724079,
      89.99931484850724,
      89.99932398963956,
      89.9993330028742,
      89.99934190242199,
      89.9993506776248,
      89.99935933203535,
      89.99936787275907,
      89.99937630690135,
      89.99938462025138,
      89.99939282346728,
      89.99940092365448,
      89.99940890660213,
      89.99941677586294,
      89.9994245527532,
      89.99943223016747,
      89.99943979389491,
      89.99944726169907,
      89.99945463357997,
      89.99946190598489,
      89.99946908601925,
      89.9994761594722,
      89.99948313344916,
      89.99949001860828,
      89.99949681139685,
      89.99950351181486,
      89.99951013407318,
      89.99951666751365,
      89.99952311213627,
      89.99952947504649,
      89.99953574558614,
      89.99954192730796,
      89.99954803442279,
      89.99955406337791,
      89.99956001062063,
      89.99956589036178,
      89.99957168128509,
      89.99957739049599,
      89.9995830250999,
      89.99958857799139,
      89.99959406693404,
      89.99959948482241,
      89.99960482455108,
      89.9996100967782,
      89.99961530150375,
      89.99962042451689,
      89.99962549068661,
      89.99963048935477,
      89.99963541696866,
      89.99964026642284,
      89.99964505903361,
      89.99964978414282,
      89.9996544524086,
      89.99965906383098,
      89.99966361485721,
      89.99966810548732,
      89.99967252861586,
      89.99967690200641,
      89.99968121144812,
      89.99968545694098,
      89.99968965624856,
      89.99969379516001,
      89.99969788078076,
      89.9997019131108,
      89.9997058850447,
      89.99970979658248,
      89.99971366548769,
      89.99971748465491,
      89.99972126474228,
      89.99972497377537,
      89.99972864372862,
      89.99973226039116,
      89.99973583086842,
      89.99973935160769,
      89.99974281905625,
      89.99974624387225,
      89.9997496296084,
      89.99975296560656,
      89.99975626607758,
      89.9997595132579,
      89.99976272135837,
      89.99976590103712,
      89.99976903097789,
      89.99977210407523,
      89.99977513809273,
      89.99977813303038,
      89.99978109244088,
      89.99978401277154,
      89.99978689757506,
      89.99978974685145,
      89.99979254994254,
      89.99979532105921,
      89.99979805309603,
      89.999800746053,
      89.99980340348283,
      89.99980602538552,
      89.99980860820837,
      89.99981115905679,
      89.99981367082536,
      89.99981615417222,
      89.99981860554466,
      89.99982102138996,
      89.99982340526084,
      89.99982575360458,
      89.99982807707933,
      89.99983036147422,
      89.99983262810555,
      89.99983485920974,
      89.99983706899765,
      89.99983923970571,
      89.99984137843934,
      89.99984348519855,
      89.99984556353606,
      89.99984762410999,
      89.99984965981493,
      89.99985165644001,
      89.99985363885425,
      89.99985558574134,
      89.9998575219703,
      89.99985942622483,
      89.99986130916308,
      89.9998631601269,
      89.99986498622174,
      89.99986679100029,
      89.99986856735713,
      89.99987031884497,
      89.99987203835839,
      89.99987374010824,
      89.9998754169891,
      89.99987708321181,
      89.99987872101282,
      89.99988033749754,
      89.9998819362187,
      89.99988350651815,
      89.99988505905402,
      89.99988659027362,
      89.99988809662422,
      89.99988958876396,
      89.99989105603471,
      89.9998925055419,
      89.99989393018008,
      89.99989534771284,
      89.99989673682389,
      89.99989811527679,
      89.9998994688607,
      89.99990081178647,
      89.99990212984325,
      89.99990343013646,
      89.9999047126661,
      89.99990598453759,
      89.99990724219823,
      89.9999084785426,
      89.99990970778153,
      89.99991091570418,
      89.99991210586326,
      89.99991327470606,
      89.99991443289072,
      89.99991557686452,
      89.99991669952205,
      89.99991779731057,
      89.99991889154639,
      89.99991997157134,
      89.9999210267273,
      89.99992208188327,
      89.99992311572295,
      89.9999241424572,
      89.99992515853332,
      89.99992616039857])




```python
from vectors import to_polar, to_cartesian
scalar_field_heatmap(landing_distance,35,40,80,100)
plt.scatter([36,37.58114751557887,39],[83,89.99992616039857,97],c='k',s=75)
plt.plot(*gradient_ascent_points(landing_distance,36,83),c='k')
plt.plot(*gradient_ascent_points(landing_distance,39,97),c='k')
plt.xlabel('theta')
plt.ylabel('phi')
plt.gcf().set_size_inches(9,7)
```


    <Figure size 504x504 with 0 Axes>



    
![output_51_1](https://user-images.githubusercontent.com/100830660/183712795-2d317af7-b3ed-47e4-b7f9-247b21631eaf.png)
    


#### 위의 히트맵에 선을 그린것을 보면 위에서 오일러 방법으로 추적한 결과값들을 선으로 연결한 것이다.
#### 점이 지속적으로 그라디언트가 0이 되는 지점으로 이동하는 것을 알 수 있다.


```python
landing_distance(37.58,90)
```




    52.98310684809294


